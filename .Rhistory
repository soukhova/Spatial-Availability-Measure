getwd()
gtha_taz <- st_read("data-inputs/OD-by-FT-Employment/tts06_83_region.shp")
library(readxl)
library(sf)
library(tidyverse)
library(units)
gtha_taz <- st_read("data-inputs/OD-by-FT-Employment/tts06_83_region.shp")
library(readxl)
library(sf)
library(tidyverse)
library(units)
gtha_taz <- st_read("data-inputs/OD-by-FT-Employment/tts06_83_region.shp")
gtha_taz <- gtha_taz %>%
st_transform(crs = 32617)
gtha_taz <- gtha_taz %>%
transmute(GTA06 = as.character(GTA06),
AREA = st_area(geometry) %>%
set_units(km^2) %>%
drop_units())
ghta_taz_id <- gtha_taz$GTA06
od_ft <- read_delim(file = "tts-2016-OD-FT-Employment.txt",
delim = "\t",
col_names = FALSE)
library(disk.frame)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(httr)
library(knitr)
#install.packages("kableExtra", dependencies = TRUE) #installing kableExtra and dependencies as I was recieving errors
library(kableExtra)
#install.packages("devtools")
#install.packages("Rtools")
#devtools::install_github("https://github.com/hrbrmstr/lodes.git", dependencies = TRUE) # if you need to download
library(lodes)
library(progress)
library(purrr)
library(r5r)
library(sf)
library(stplanr)
library(tidycensus)
library(tidyr)
library(tmap)
library(zoo) # for rollapplyr
# setup for disk.frame
setup_disk.frame()
options(scipen = 999)
options(java.parameters = "-Xmx6G")
options(future.globals.maxSize = Inf)
tmap_mode("view")
load(file = "data-inputs/Travel-Time-Calculations/inputs/workers_origins.Rdata")
load(file = "data-inputs/Travel-Time-Calculations/inputs/jobs_destinations.Rdata")
od_ft <- read_delim(file = "data-inputs/OD-by-FT-Employment/tts-2016-OD-FT-Employment.txt",
delim = "\t",
col_names = FALSE)
idx <- which(od_ft$X1 == "TABLE    : emp_stat (Full time)")
od_ft <- od_ft %>%
slice((idx+2):n())
od_ft <- od_ft %>%
separate(X1, into = c("Zones", "Persons"), sep = " (?=[^ ]+$)") %>%
mutate(Zones = str_trim(Zones, side = "both")) %>%
separate(Zones, into = c("Origin", "Destination"), sep = " (?=[^ ]+$)") %>%
mutate(Origin = str_trim(Origin),
Destination = str_trim(Destination),
Persons = as.numeric(Persons))
workers_ft <- od_ft %>%
group_by(Origin) %>%
summarize(workers = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Origin,
workers)
jobs_ft <- od_ft %>%
group_by(Destination) %>%
summarize(jobs = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Destination,
jobs)
gtha_taz <- gtha_taz %>%
# Join workers
left_join(workers_ft,
by = "GTA06") %>%
# Join jobs
left_join(jobs_ft,
by = "GTA06") %>%
# Replace NAs with zeros
mutate(workers = replace_na(workers, 0),
jobs = replace_na(jobs, 0))
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = workers),
color = NA) +
scale_fill_fermenter(direction = 1)
load(file = "data-inputs/Travel-Time-Calculations/inputs/workers_origins.Rdata")
load(file = "data-inputs/Travel-Time-Calculations/inputs/jobs_destinations.Rdata")
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = workers),
color = NA) +
scale_fill_fermenter(direction = 1)
library(readxl)
library(sf)
library(tidyverse)
library(units)
gtha_taz <- st_read("data-inputs/OD-by-FT-Employment/tts06_83_region.shp")
gtha_taz <- gtha_taz %>%
st_transform(crs = 32617)
gtha_taz <- gtha_taz %>%
transmute(GTA06 = as.character(GTA06),
AREA = st_area(geometry) %>%
set_units(km^2) %>%
drop_units())
ghta_taz_id <- gtha_taz$GTA06
od_ft <- read_delim(file = "data-inputs/OD-by-FT-Employment/tts-2016-OD-FT-Employment.txt",
delim = "\t",
col_names = FALSE)
idx <- which(od_ft$X1 == "TABLE    : emp_stat (Full time)")
od_ft <- od_ft %>%
slice((idx+2):n())
od_ft <- od_ft %>%
separate(X1, into = c("Zones", "Persons"), sep = " (?=[^ ]+$)") %>%
mutate(Zones = str_trim(Zones, side = "both")) %>%
separate(Zones, into = c("Origin", "Destination"), sep = " (?=[^ ]+$)") %>%
mutate(Origin = str_trim(Origin),
Destination = str_trim(Destination),
Persons = as.numeric(Persons))
workers_ft <- od_ft %>%
group_by(Origin) %>%
summarize(workers = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Origin,
workers)
jobs_ft <- od_ft %>%
group_by(Destination) %>%
summarize(jobs = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Destination,
jobs)
gtha_taz <- gtha_taz %>%
# Join workers
left_join(workers_ft,
by = "GTA06") %>%
# Join jobs
left_join(jobs_ft,
by = "GTA06") %>%
# Replace NAs with zeros
mutate(workers = replace_na(workers, 0),
jobs = replace_na(jobs, 0))
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = workers),
color = NA) +
scale_fill_fermenter(direction = 1)
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = jobs),
color = NA) +
scale_fill_fermenter(direction = 1)
gtha_taz_cent <- st_centroid(gtha_taz)
#workers (origins)
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
work_origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#jobs (destinations)
jobs_ft_cent <- jobs_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
job_destinations <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
save("work_origins", file = "data-inputs/Travel-Time-Calculations/inputs/work_origins.Rdata")
save("job_destinations", file = "data-inputs/Travel-Time-Calculations/inputs/job_destinations.Rdata")
#workers (origins)
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
work_origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 32617))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#jobs (destinations)
jobs_ft_cent <- jobs_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
job_destinations <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 32617))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
save("work_origins", file = "data-inputs/Travel-Time-Calculations/inputs/work_origins.Rdata")
save("job_destinations", file = "data-inputs/Travel-Time-Calculations/inputs/job_destinations.Rdata")
usethis::use_github()
