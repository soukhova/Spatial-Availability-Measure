library(readxl)
library(sf)
library(tidyverse)
library(units)
gtha_taz <- st_read("tts06_83_region.shp")
gtha_taz <- gtha_taz %>%
st_transform(crs = 32617)
gtha_taz <- gtha_taz %>%
transmute(GTA06 = as.character(GTA06),
AREA = st_area(geometry) %>%
set_units(km^2) %>%
drop_units())
ghta_taz_id <- gtha_taz$GTA06
od_ft <- read_delim(file = "tts-2016-OD-FT-Employment.txt",
delim = "\t",
col_names = FALSE)
idx <- which(od_ft$X1 == "TABLE    : emp_stat (Full time)")
od_ft <- od_ft %>%
slice((idx+2):n())
od_ft <- od_ft %>%
separate(X1, into = c("Zones", "Persons"), sep = " (?=[^ ]+$)") %>%
mutate(Zones = str_trim(Zones, side = "both")) %>%
separate(Zones, into = c("Origin", "Destination"), sep = " (?=[^ ]+$)") %>%
mutate(Origin = str_trim(Origin),
Destination = str_trim(Destination),
Persons = as.numeric(Persons))
workers_ft <- od_ft %>%
group_by(Origin) %>%
summarize(workers = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Origin,
workers)
jobs_ft <- od_ft %>%
group_by(Destination) %>%
summarize(jobs = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Destination,
jobs)
gtha_taz <- gtha_taz %>%
# Join workers
left_join(workers_ft,
by = "GTA06") %>%
# Join jobs
left_join(jobs_ft,
by = "GTA06") %>%
# Replace NAs with zeros
mutate(workers = replace_na(workers, 0),
jobs = replace_na(jobs, 0))
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = workers),
color = NA) +
scale_fill_fermenter(direction = 1)
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = jobs),
color = NA) +
scale_fill_fermenter(direction = 1)
View(od_ft)
View(jobs_ft)
View(workers_ft)
View(gtha_taz)
View(gtha_taz)
library(disk.frame)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(httr)
library(knitr)
#install.packages("kableExtra", dependencies = TRUE) #installing kableExtra and dependencies as I was recieving errors
library(kableExtra)
#install.packages("devtools")
#install.packages("Rtools")
#devtools::install_github("https://github.com/hrbrmstr/lodes.git", dependencies = TRUE) # if you need to download
library(lodes)
library(progress)
library(purrr)
library(r5r)
library(sf)
library(stplanr)
library(tidycensus)
library(tidyr)
library(tmap)
library(zoo) # for rollapplyr
# setup for disk.frame
setup_disk.frame()
options(scipen = 999)
options(java.parameters = "-Xmx6G")
options(future.globals.maxSize = Inf)
tmap_mode("view")
url <-"https://www.toronto.ca/wp-content/uploads/2017/10/96cf-EDC-Greater-Golden-Horseshoe-Map.png"
![](`r url`)
<center><img src="`r url`"></center>
<center><img src="`r url`"></center>
<center><img src="`r url`"></center>
<center><img src="`r url`"></center>
In this notebook, we find the car and transit travel time from origins (centroids of work zones) to destinations (centroids of full-time employment zones) for a one-way morning commute for the GTHA area.
```{r, include=FALSE}
url <-"https://www.toronto.ca/wp-content/uploads/2017/10/96cf-EDC-Greater-Golden-Horseshoe-Map.png"
```
## CMA
![Caption for the picture.]("https://www.toronto.ca/wp-content/uploads/2017/10/96cf-EDC-Greater-Golden-Horseshoe-Map.png")
![Caption for the picture.]("https://www.toronto.ca/wp-content/uploads/2017/10/96cf-EDC-Greater-Golden-Horseshoe-Map.png")
![test](https://www.toronto.ca/wp-content/uploads/2017/10/96cf-EDC-Greater-Golden-Horseshoe-Map.png)
![map](/Greater-Golden-Horseshoe-Map.png)
![](Greater-Golden-Horseshoe-Map.png)
library(readxl)
library(sf)
library(tidyverse)
library(units)
library(readxl)
library(sf)
library(tidyverse)
library(units)
gtha_taz <- st_read("tts06_83_region.shp")
gtha_taz <- gtha_taz %>%
st_transform(crs = 32617)
gtha_taz <- gtha_taz %>%
transmute(GTA06 = as.character(GTA06),
AREA = st_area(geometry) %>%
set_units(km^2) %>%
drop_units())
ghta_taz_id <- gtha_taz$GTA06
od_ft <- read_delim(file = "tts-2016-OD-FT-Employment.txt",
delim = "\t",
col_names = FALSE)
idx <- which(od_ft$X1 == "TABLE    : emp_stat (Full time)")
od_ft <- od_ft %>%
slice((idx+2):n())
od_ft <- od_ft %>%
separate(X1, into = c("Zones", "Persons"), sep = " (?=[^ ]+$)") %>%
mutate(Zones = str_trim(Zones, side = "both")) %>%
separate(Zones, into = c("Origin", "Destination"), sep = " (?=[^ ]+$)") %>%
mutate(Origin = str_trim(Origin),
Destination = str_trim(Destination),
Persons = as.numeric(Persons))
workers_ft <- od_ft %>%
group_by(Origin) %>%
summarize(workers = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Origin,
workers)
jobs_ft <- od_ft %>%
group_by(Destination) %>%
summarize(jobs = sum(Persons),
.groups = "drop") %>%
transmute(GTA06 = Destination,
jobs)
gtha_taz <- gtha_taz %>%
# Join workers
left_join(workers_ft,
by = "GTA06") %>%
# Join jobs
left_join(jobs_ft,
by = "GTA06") %>%
# Replace NAs with zeros
mutate(workers = replace_na(workers, 0),
jobs = replace_na(jobs, 0))
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = workers),
color = NA) +
scale_fill_fermenter(direction = 1)
ggplot() +
geom_sf(data = gtha_taz,
aes(fill = jobs),
color = NA) +
scale_fill_fermenter(direction = 1)
gtha_taz_Cent <- st_centroid(gtha_taz)
View(gtha_taz_Cent)
workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06")
gtha_taz_cent <- st_centroid(gtha_taz)
workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06")
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06")
origins <- cbind(as.data.frame(workers_ft_cent), st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat)
origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat)
origins <- cbind(workers_ft_cent, st_coordinates(st_transform(st_sf(workers_ft_cent), crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat)
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat)
View(origins)
origins <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#jobs (destinations)
jobs_ft_cent <- jobs_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
origins <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#workers (origins)
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#jobs (destinations)
jobs_ft_cent <- jobs_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
destinations <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#jobs (destinations)
jobs_ft_cent <- jobs_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
job_destinations <- cbind(jobs_ft_cent, st_coordinates(st_transform(jobs_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
#workers (origins)
workers_ft_cent <- workers_ft %>% merge(gtha_taz_cent %>% select(GTA06), by="GTA06") %>% st_sf
work_origins <- cbind(workers_ft_cent, st_coordinates(st_transform(workers_ft_cent, crs = 4326))) %>%
rename(lon = "X", lat = "Y", id = "GTA06") %>%
select(id, lon, lat) %>% as.data.frame()
