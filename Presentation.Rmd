---
title: "Estimating spatial availability/mismatch using singly constrained accessibility measures"
subtitle: "Planning"
author: "Anastasia Soukhov, etc."
date: "2022-01-22"
output:
  xaringan::moon_reader:
    nature:
      slideNumberFormat: "%current% / X" 
      highlightStyle: github
      highlightLines: true
      ratio: '16:9'
      countIncrementalSlides: false
---
```{r load-packages, include=FALSE, cache=FALSE}
library(AccessPack)
library(dplyr)
library(fitdistrplus)
library(ggplot2)
library(kableExtra)
library(patchwork)
library(sf)
library(scales)
library(ggpmisc)
library(ggrepel)
library(cowplot)
library(ggspatial)
options(scipen = 999)
```

# Background

- Conventional accessibility is widely used and is defined as follows:

$$A_i = \sum_{j=1}^JO_jf(c_{ij})$$

Where:

-   $A$ is accessibility. 
-   $i$ is a set of origin locations.
-   $j$ is a set of destination locations.
-   $O_j$ is the number of opportunities at location $j$. These are opportunities for activity and add some sort of *supply* to the area;
-   $c_{ij}$ is a measure of the cost of moving between $i$ and $j$
-   $f(\cdot)$ is an impedance function of $c_{ij}$; it can take the form of any monotonically decreasing function (e.g., negative exponential distribution) .

---

# Background: Accessibility

```{r toy-example-accessibility, include = FALSE}
# Calculate impedance function
beta <- 0.0015
toy_od_table <- toy_od_table %>%
  mutate(f = exp(-beta * distance))

# using the origin-destination table (OD) of all origin to destination trips; filter in only jobs which are mean distance or less away from a population center and sum number of jobs available in each origin (population center)
c_accessibility <- toy_od_table %>% 
  mutate(A_ij = f * Jobs) %>%
  group_by(Origin) %>%
  summarise(A_i = sum(A_ij))

#pass conventional accessibility calculation into the spatial object (toy_sim_zones)
toy_sim_zones_access  <- toy_sim_zones %>% 
  left_join(c_accessibility, 
            by = c("id" = "Origin")) 
```


```{r, echo=FALSE, fig.align='center', fig.height=5}
ggplot() +
  geom_sf(data = toy_sim_zones_access %>% 
            filter(type == "population"),
          aes(fill = A_i, size = A_i, shape = type)) +
  geom_sf(data = toy_sim_zones_access %>%
            filter(type == "jobs"),
          aes(shape = type,
              size = number),
          fill = "black") +
  geom_sf_text(data = toy_sim_zones_access , aes(label = id_short),
               size = 3, nudge_y = -400) +
  scale_shape_manual(values = c('population' = 24, 'jobs' = 21),
                     name = "Location Type",
                     labels=c("Population", "Jobs"),
                     guide = guide_legend(order = 2)) +
  guides(shape =guide_legend(override.aes=list(size=5))) +
  scale_size_continuous(range = c(2,7), name = "Accessibility \n(A_i)", guide = "none") +
  scale_fill_distiller(palette = "OrRd", direction = 1, name = "Accessibility \n(A_i)",
                      limits = c(0, max(toy_sim_zones_access$A_i)),
                      guide = guide_colorbar(order = 1)) +
  theme(legend.position = "right", axis.text = element_blank(), axis.title = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_rect(size = 1.5,
                                        color = "grey",
                                        fill = "gray95"))
```
-   higher accessibility of population centers (triangles) which are closer to the two larger employment centers.

-   Remote population centers near the left edge of the map have the lowest levels of job accessibility as they are only in proximity to the small employment center.

---

# Background: Issues with Accessibility

- conglomeration effect - multiple-counting of opportunities (jobs) results in unclear interpretability; for instance, P5 has an accessibility score of 600 meaning that population center of 490 workers has access to 600 jobs. This makes sense as P5 is very close to a large employment center. The assumption here is that this opportunity is divisible and non-competitive meaning that if a densely populated population center pops up next to P5 - it too will have a high accessibility score. Conventional accessibility does not consider competition of opportunities (jobs) from neighbouring demand (population centers). This neglect of opportunity-constrainted (single-constrained) competition obscures the interpretability of conventional accessibility which may  manifests in the following two ways of biased estimation:

1) less dense urban periphery demand centers may be assigned disproportionately _high_ accessibility values. These periphery areas are located right outside dense urban demand centers and large urban opportunity centeres and thus may have low travel cost to these large opportunity centers. Accessibility does not consider opportunity-constraints and as such these periphery demand centers benefit from the high accessibility to opportunities without competition considerations from their more dense and centrally located neighbours.

2) remote/isolated areas which are still within the region of the analysis and have regionally-relative low demand centers, opportunity centers, and travel cost to opportunity centers, are assigned disproportionately _low_ accessibility values. These remote/isolated areas may be sufficiently supplied with opportunities proportionate to their demand but is obscured by the artificially high accessibility awarded to periphery/other areas in which conglomeration disproportionally occurs. 

---

# Ideas
- maybe remove the use cases? Or change their order? 

